<html>
<head>
	<title></title>
</head>
<body>

<script>

function makeGrid(xs, ys) {
	grid = [];
	for (var y = 0; y < ys; y++) {
		grid[y] = [];
		for (var x = 0; x < xs; x++) {
			grid[y][x] = 0; 
		}
	}

	return grid; 
}

function randomlySeedGrid(grid) {
	for (var y = 0; y < grid.length; y++) {
		for (var x = 0; x < grid[y].length; x++) {
			// Get a random binary number. 1.1 multiplier will return more
			// zeros than ones.
			grid[y][x] = Math.floor(Math.random() * 1.1);
		}
	}

	return grid;
}

function drawGrid(grid) {
	var cellSize = 5;
	var currentCanvas = document.getElementsByTagName('canvas');

	if (currentCanvas.length) {
		canvas = currentCanvas[0];
	} else {
		// Create a new canvas.
		var gridWidth = grid[0].length * cellSize;
		var gridHeight = grid.length * cellSize;
		var canvas = document.createElement('canvas');
		canvas.height = gridHeight;
		canvas.width = gridWidth;
		canvas.style.border = '1px solid black'
		document.body.appendChild(canvas);
	}

	var context = canvas.getContext('2d');

	context.clearRect(0, 0, canvas.height, canvas.width);
	
	for (var y = 0; y < grid.length; y++) {
		for (var x = 0; x < grid[y].length; x++) {
			if (grid[y][x] === 1) {
				var top = x == 0 ? x : x * cellSize;
				var left = y == 0 ? y : y * cellSize;
				context.fillRect(top, left, cellSize, cellSize);
			}
		}
	}
	return grid;
}

function countNeighbors(grid, x, y) {
		var n = grid[y - 1] !== undefined ? grid[y - 1][x] : 0;
		var s = grid[y + 1] !== undefined ? grid[y + 1][x] : 0;
		var e = grid[y] !== undefined ? grid[y][x + 1] : 0;
		var w = grid[y] !== undefined ? grid[y][x - 1] : 0;
		var nw = grid[y - 1] !== undefined ? grid[y - 1][x - 1] : 0;
		var ne = grid[y - 1] !== undefined ? grid[y - 1][x + 1] : 0;
		var sw = grid[y + 1] !== undefined ? grid[y + 1][x - 1] : 0;
		var se = grid[y + 1] !== undefined ? grid[y + 1][x + 1] : 0;
		var neighbors = [n, s, e, w, ne, nw, se, sw];
		var count = neighbors.reduce(function(a, b) { return a + b; });
		return count;
}

function advanceGrid(grid) {
	for (var y = 0; y < grid.length; ++y) {
		for (var x = 0; x < grid[y].length; ++x) {
			// count neighbors.
			var count = countNeighbors(grid, x, y);
			// apply rules.
			if (count === 3) {
				grid[y][x] = 1;
			} else if (count > 3 || count < 2) {
				grid[y][x] = 0;
			}
		}
	}
	return grid;
}

function main() {
	grid = makeGrid(150, 150);
	randomlySeedGrid(grid);
	loop = function () { 
		drawGrid(grid);
		advanceGrid(grid);
	}
	setInterval(loop, 100);
}

main();

</script>
</body>
</html>